# 画像→テキスト化・保存・照合チェック用 プロンプト

書籍・問題集の画像をテキストに起こし、指定ファイルに保存したうえで、**元画像と照合して誤字脱字を減らす**ための一連の作業用プロンプトです。

---

## 前提・実行環境

- **画像は `local_data` のまま** 置く（Git に上げない想定のため `.gitignore` 対象であり、ワークスペースの検索ではヒットしないことがある）。
- **テキスト化（OCR 等）はターミナルでスクリプトを実行**して行う。スクリプトには画像フォルダの **絶対パス** を渡し、ローカルで画像にアクセスする。
- AI は「スクリプトの実行指示」「スクリプト出力の受け取りと問題文・解答解説への分類」「Markdown への保存」「照合チェックと修正」を担当する。

---

## 使い方

1. 下記の **メインプロンプト** をコピーする。
2. `[ ]` で囲んだ部分を、実際の **問題文用パス**・**解答解説用パス**・**画像フォルダの絶対パス** に置き換える。
3. AI（または作業者）に渡して実行する。第1段階では、**ターミナルでテキスト化スクリプトを実行**し、その出力を問題文・解答解説に分類して利用する。
4. **照合チェック** まで完了したら、指摘された誤字脱字を該当ファイルで修正する。

---

## メインプロンプト（コピー用）

```
あなたは、技術書・問題集のページ画像を正確にテキスト化し、誤字脱字の少ない形で保存する専門家です。

## 役割
- 指定された画像を **問題文** と **解答・解説** に分類してテキスト化する。
- テキストは指定のMarkdownファイルに保存する。
- 最後に **元画像と照合** し、誤字脱字・抜け・表記ゆれを洗い出し、修正案を提示する。

## 前提
- 画像は **local_data のまま** 置く（Git には上げない）。
- **テキスト化はターミナルでスクリプトを実行**して行う。スクリプトに画像フォルダの絶対パスを渡し、出力（テキストやJSON等）を受け取って問題文・解答解説に分類する。

## 入力
- **画像の場所**: [画像フォルダの絶対パス]
  - 例: `C:\Users\xxx\project\local_data\pdf_output\ch3_JavaSE17Silver_1Z0_825_images`
- **想定**: 1ページ1画像で、ファイル名にページ番号（例: page_0001.png）が含まれる。

## 作業手順

### 第1段階: 画像のテキスト化と分割

1. **ターミナルでテキスト化スクリプトを実行**し、画像フォルダ（絶対パス）を引数に渡す。スクリプトが出力したテキストを順に受け取り、内容を判別する。
   - **問題文**: 章タイトル、問題番号、問題文、コードブロック、選択肢（A. B. C. …）。
   - **解答解説**: 問題番号、正解（例: 1. C）、解説文、コード例、表など。

2. **出力テキストのルール**
   - **問題文**用テキスト:
     - 章見出し（例: 第○章 ○○）
     - 各問を `## 1.` `## 2.` … のように見出しで区切る。
     - コードは ```java … ``` で囲む（言語指定は可能なら付ける）。
     - 選択肢は `- A. 〜` `- B. 〜` の形式で箇条書き。
     - 空欄は `__________` や `// この部分が空欄` などで明示する。
   - **解答解説**用テキスト:
     - 各問を `## 1. C` のように「番号. 正解」で見出し。
     - 解説は段落で記述。リストやコードブロックを適宜使用。
     - 正解が複数（例: A, C, D）の場合は見出しにそのまま含める（`## 2. A, C, D`）。

3. **分割の基準**
   - 問題が載っているページ → 問題文用テキストに追記。
   - 解答・解説が載っているページ → 解答解説用テキストに追記。
   - 同じ問が複数ページにまたがる場合は、1問としてつなげて記述する。

### 第2段階: ファイルへの保存

4. テキストの保存先を次のとおりにする。
   - **[問題文]** → [問題文用ファイルの相対パス]
     - 例: `java_blackbook\local_problems\questions\Chapter3_questions.md`
   - **[解答解説]** → [解答解説用ファイルの相対パス]
     - 例: `java_blackbook\local_problems\answers\Chapter3_answers.md`
   - 既存ファイルがある場合は **上書き** するか、**追記・マージ** するかは指示に従う（未指示の場合は上書きでよい）。

### 第3段階: 元画像との照合チェック（必須）

5. **照合のやり方**
   - 保存した問題文・解答解説の **各セクション（各問）** について、対応する元画像を再度開く（ターミナルでスクリプトを実行して画像を参照する、または出力された画像パスを利用する）。
   - 次の項目を **1問ずつ** 確認する:
     - 問題番号・見出しの一致
     - コードの写し間違い（括弧、セミコロン、スペース、改行）
     - 選択肢の文言（「trueが表示される」と「「true」と表示される」などの表記差もメモ）
     - 正解の記号（A, B, C, D や「6行目」「8行目」など）の一致
     - 数値・行番号・ページ参照の誤り

6. **照合結果の出力**
   - 次の形式で **照合結果レポート** を出力する（別ファイルまたはチャットでよい）。
   - レポートに含める内容:
     - **一致**: 問題番号の一覧（または「問題1〜43 問題文・選択肢は画像と一致」のようにまとめ可）。
     - **要修正**: 誤字脱字・不一致ごとに「問○」「該当箇所」「現状のテキスト」「正しくあるべき内容」「理由（どの画像の何と比較したか）」を記載。
     - **要確認**: 表記ゆれや解釈が分かれる部分（例: 括弧の有無、全角/半角）があれば簡潔に列挙。

7. **修正の反映**
   - 「要修正」に挙げた箇所について、該当するMarkdownファイルを **実際に編集** して修正する。
   - 修正後、該当問について「修正済み」と照合レポートに追記するか、修正内容を一覧でまとめる。

## 出力のまとめ

- 第1・2段階の結果: 指定した [問題文] 用・[解答解説] 用のファイルにテキストが保存されていること。
- 第3段階の結果: 照合結果レポート（一致・要修正・要確認）が出力され、**要修正はすべて該当ファイルに反映済み**であること。
```

---

## テンプレート（置き換え用）

プロジェクト内で使うときは、次のように置き換えてください。

| プレースホルダ | 説明 | 例 |
|----------------|------|-----|
| `[画像フォルダの絶対パス]` | ページ画像が入ったフォルダ（**絶対パス**。local_data のまま。スクリプトに渡す） | `C:\Users\xxx\project\local_data\pdf_output\ch3_JavaSE17Silver_1Z0_825_images` |
| `[問題文]` / 問題文用ファイルの相対パス | 問題文を保存するMarkdown | `java_blackbook\local_problems\questions\Chapter3_questions.md` |
| `[解答解説]` / 解答解説用ファイルの相対パス | 解答・解説を保存するMarkdown | `java_blackbook\local_problems\answers\Chapter3_answers.md` |

---

## 簡易版（チェックのみ行う場合）

すでにテキスト化済みで、「照合チェックだけ」行いたいとき用の短いプロンプトです。画像は local_data にある場合は、ターミナルでスクリプトを実行して画像を参照する。

```
次の2つのファイルの内容が、指定フォルダ内の画像と一致しているか照合してください。

- 問題文: [問題文ファイルの相対パス]
- 解答解説: [解答解説ファイルの相対パス]
- 照合元画像: [画像フォルダの絶対パス]（local_data 内の場合はターミナルでスクリプトを実行して参照）

手順:
1. 各問について、対応する画像を開き（必要ならターミナルでスクリプト実行）、問題文・コード・選択肢・正解を比較する。
2. 一致している部分は「一致」として一覧またはまとめで報告する。
3. 誤字脱字・行番号の誤り・正解の誤りがあれば「要修正」として、問番号・該当箇所・正しい内容を記載する。
4. 要修正箇所は、該当するMarkdownファイルを編集して修正する。
```

---

## 運用のコツ

- 画像は **local_data のまま** とし、テキスト化・照合時の画像参照は **ターミナルでスクリプトを実行**して行う（絶対パスでアクセスする）。
- **1章ずつ** 問題文・解答解説を分けて実行すると、照合がしやすく、誤字脱字も減らしやすい。
- 画像の **ページ番号**（page_0001 など）と、問題番号・解答ページの対応をメモしておくと、照合時に参照しやすい。
- 照合レポートは `scoring_result` や `docs` に「Chapter○_照合結果.md」のように保存しておくと、後から見直しやすい。

---

## 関連

- 採点結果の基準となる解答ファイル: `java_blackbook\local_problems\answers\Chapter○_answers.md`
- 採点結果の更新: 解答を修正したあとは、`java_blackbook\local_problems\scoring_result\Chapter○_ScoringResult_*.md` と演習ファイルの照合を行い、必要なら採点内容を修正する。
