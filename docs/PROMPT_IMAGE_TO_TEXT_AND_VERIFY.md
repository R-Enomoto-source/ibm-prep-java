# 画像→テキスト化・保存・照合チェック用 プロンプト

書籍・問題集の画像をテキストに起こし、指定ファイルに保存したうえで、**元画像と照合して誤字脱字を減らす**ための一連の作業用プロンプトです。

---

## 前提・実行環境

- **画像は指定された画像フォルダ（絶対パス）に置く**。
- **テキスト化（OCR）は Python 等のスクリプトやコマンドではなく、生成AI が画像を直接読み取り、正確なテキストを取得する**。画像は絶対パスで指定し、AI が各画像を開いて内容を認識・書き起こす。
- AI は「画像の読み取り（OCR）」「問題文・解答解説への分類」「Markdown への保存」「照合チェックと修正」を担当する。

---

## 使い方

1. 下記の **メインプロンプト** をコピーする。
2. 冒頭の **「指定（最初に記入すること）」** にある `[ ]` で囲んだ部分を、実際の **画像フォルダの絶対パス**・**問題文用ファイルの相対パス**・**解答解説用ファイルの相対パス** に置き換える。
3. AI（または作業者）に渡して実行する。第1段階では、**生成AI が各画像を読み取り（OCR）してテキストを取得**し、その内容を問題文・解答解説に分類して利用する。
4. **照合チェック** まで完了したら、指摘された誤字脱字を該当ファイルで修正する。

---

## メインプロンプト（コピー用）

```
あなたは、技術書・問題集のページ画像を正確にテキスト化し、誤字脱字の少ない形で保存する専門家です。

## 指定（最初に記入すること）

以下を実行前に必ず記入する。

- **画像フォルダ（入力）**: [画像フォルダの絶対パス]
  - 例: `C:\Users\xxx\project\pdf_output\ch3_JavaSE17Silver_1Z0_825_images`
  - 想定: 1ページ1画像で、ファイル名にページ番号（例: page_0001.png）が含まれる。
- **問題文の保存先**: [問題文用ファイルの相対パス]
  - 例: `java_blackbook\local_problems\questions\Chapter3_questions.md`
- **解答解説の保存先**: [解答解説用ファイルの相対パス]
  - 例: `java_blackbook\local_problems\answers\Chapter3_answers.md`

## 役割
- 上記で指定した画像を **問題文** と **解答・解説** に分類してテキスト化する。
- テキストは上記で指定したMarkdownファイルに保存する。
- 最後に **元画像と照合** し、誤字脱字・抜け・表記ゆれを洗い出し、修正案を提示する。

## 前提
- **テキスト化は Python 等のコードやコマンドではなく、生成AI（自分）が画像を直接読み取り、OCR として正確なテキストを取得する**。上記で指定した画像フォルダの絶対パスを元に各画像を開き、内容を認識・書き起こしてから問題文・解答解説に分類する。

## 読み取り・出力の基本方針（正確性のため必須）

- **読み取りは複数回・少ない枚数ずつ行う**
  - 画像を**一度にすべて読み取らず**、**1回あたり 3〜8 枚程度**に区切り、その範囲のテキストを確定してから次の範囲に進む。
  - 各回で「どの画像（ファイル名・ページ番号）を読んだか」を明示し、取得したテキストを問題文用・解答解説用に振り分けてから次へ進む。必要なら**同じ画像を照合時に再度開いて**確認する。
- **出力（テキストの書き出し・保存）も範囲を分けて行う**
  - 問題文・解答解説を**一括で書き出さず**、**問の範囲（例: 問1〜10、問11〜20…）またはページ範囲（例: 画像 1〜5、6〜10…）で区切って**、その範囲ごとにMarkdownに追記・保存する。
  - 各範囲の出力を確定（または確認）してから次の範囲に進む。これにより誤字脱字・抜けを減らし、照合もしやすくする。

## 作業手順

### 第1段階: 画像のテキスト化と分割

1. **読み取り（複数回に分けて実行）**
   - まず画像フォルダ内の**ファイル一覧**を把握する（枚数、ページ番号の並び）。
   - **1回目**: 先頭から **3〜8 枚程度**の画像を開き、生成AI が画像を直接読み取って（OCR）正確なテキストを取得する。スクリプトやコマンドは使わず、画像を見て内容を書き起こす。
   - 取得したテキストの内容を判別する:
     - **問題文**: 章タイトル、問題番号、問題文、コードブロック、選択肢（A. B. C. …）。
     - **解答解説**: 問題番号、正解（例: 1. C）、解説文、コード例、表など。
   - **2回目以降**: 続きの画像を同じく **3〜8 枚程度ずつ**開き、同様に読み取り・判別を繰り返す。**全画像を読み終わるまで複数回に分けて行う**。

2. **出力テキストのルール**
   - **問題文**用テキスト:
     - 章見出し（例: 第○章 ○○）
     - 各問を `## 1.` `## 2.` … のように見出しで区切る。
     - コードは ```java … ``` で囲む（言語指定は可能なら付ける）。
     - 選択肢は `- A. 〜` `- B. 〜` の形式で箇条書き。
     - 空欄は `__________` や `// この部分が空欄` などで明示する。
   - **解答解説**用テキスト:
     - 各問を `## 1. C` のように「番号. 正解」で見出し。
     - 解説は段落で記述。リストやコードブロックを適宜使用。
     - 正解が複数（例: A, C, D）の場合は見出しにそのまま含める（`## 2. A, C, D`）。

3. **分割の基準**
   - 問題が載っているページ → 問題文用テキストに追記。
   - 解答・解説が載っているページ → 解答解説用テキストに追記。
   - 同じ問が複数ページにまたがる場合は、1問としてつなげて記述する。

### 第2段階: ファイルへの保存（複数回に分けて出力）

4. **出力も範囲を分けて行う**
   - 第1段階で得たテキストを、**問の範囲（例: 問1〜10、問11〜20…）または読み取った画像のブロックごと**に区切る。
   - **1回目**: 最初の範囲（例: 問1〜10 または 1回目に読んだ画像分）を、指定のMarkdown形式で「問題文の保存先」「解答解説の保存先」に**書き出し・保存**する。
   - **2回目以降**: 次の範囲を同様に**追記または上書き**する。既存ファイルがある場合は **上書き** するか **追記・マージ** するかは指示に従う（未指示の場合は上書きでよい）。**全範囲を書き終わるまで複数回に分けて保存する**。
   - 各範囲の保存後に、書き出した見出し・問題番号が意図どおりか簡単に確認してから次に進むとよい。

### 第3段階: 元画像との照合チェック（必須）

5. **照合のやり方（複数回に分けて実行可）**
   - 保存した問題文・解答解説の **各セクション（各問）** について、対応する元画像を再度開き、生成AI が画像を直接読み取って照合する。
   - 照合も **問の範囲で区切って**（例: 問1〜15、問16〜30…）行ってよい。その都度、該当する画像だけを開いて読み取り、一致・要修正・要確認をメモする。
   - 次の項目を **1問ずつ** 確認する:
     - 問題番号・見出しの一致
     - コードの写し間違い（括弧、セミコロン、スペース、改行）
     - 選択肢の文言（「trueが表示される」と「「true」と表示される」などの表記差もメモ）
     - 正解の記号（A, B, C, D や「6行目」「8行目」など）の一致
     - 数値・行番号・ページ参照の誤り

6. **照合結果の出力**
   - 次の形式で **照合結果レポート** を出力する（別ファイルまたはチャットでよい）。
   - レポートに含める内容:
     - **一致**: 問題番号の一覧（または「問題1〜43 問題文・選択肢は画像と一致」のようにまとめ可）。
     - **要修正**: 誤字脱字・不一致ごとに「問○」「該当箇所」「現状のテキスト」「正しくあるべき内容」「理由（どの画像の何と比較したか）」を記載。
     - **要確認**: 表記ゆれや解釈が分かれる部分（例: 括弧の有無、全角/半角）があれば簡潔に列挙。

7. **修正の反映**
   - 「要修正」に挙げた箇所について、該当するMarkdownファイルを **実際に編集** して修正する。
   - 修正後、該当問について「修正済み」と照合レポートに追記するか、修正内容を一覧でまとめる。

## 出力のまとめ

- 第1・2段階の結果: 「指定」で示した問題文用・解答解説用のファイルにテキストが保存されていること。**読み取り・出力は複数回に分けて行い、各範囲を確定してから次に進んでいること。**
- 第3段階の結果: 照合結果レポート（一致・要修正・要確認）が出力され、**要修正はすべて該当ファイルに反映済み**であること。
```

---

## テンプレート（置き換え用）

メインプロンプト冒頭の **「指定（最初に記入すること）」** に、次のプレースホルダを実際のパスに置き換えて記入してください。

| プレースホルダ | 説明 | 例 |
|----------------|------|-----|
| `[画像フォルダの絶対パス]` | ページ画像が入ったフォルダ（**絶対パス**。生成AI が画像を開いてOCRする） | `C:\Users\xxx\project\pdf_output\ch3_JavaSE17Silver_1Z0_825_images` |
| `[問題文]` / 問題文用ファイルの相対パス | 問題文を保存するMarkdown | `java_blackbook\local_problems\questions\Chapter3_questions.md` |
| `[解答解説]` / 解答解説用ファイルの相対パス | 解答・解説を保存するMarkdown | `java_blackbook\local_problems\answers\Chapter3_answers.md` |

---

## 簡易版（チェックのみ行う場合）

すでにテキスト化済みで、「照合チェックだけ」行いたいとき用の短いプロンプトです。画像は生成AI が直接開いて読み取り、照合する。

```
次の2つのファイルの内容が、指定フォルダ内の画像と一致しているか照合してください。

- 問題文: [問題文ファイルの相対パス]
- 解答解説: [解答解説ファイルの相対パス]
- 照合元画像: [画像フォルダの絶対パス]（生成AI が画像を直接開いて読み取り、照合する）

手順:
1. 各問について、対応する画像を開き（生成AI が画像を直接読み取る）、問題文・コード・選択肢・正解を比較する。
2. 一致している部分は「一致」として一覧またはまとめで報告する。
3. 誤字脱字・行番号の誤り・正解の誤りがあれば「要修正」として、問番号・該当箇所・正しい内容を記載する。
4. 要修正箇所は、該当するMarkdownファイルを編集して修正する。
```

---

## 運用のコツ

- テキスト化・照合時は **生成AI が画像を直接開いて読み取り（OCR）して** 行う（絶対パスで画像を指定する）。Python 等のスクリプトやコマンドは使わない。
- **読み取りは 3〜8 枚程度ずつ、出力は問の範囲（例: 10問ずつ）で分ける**と、正確にテキスト化しやすく、抜け・誤字も減る。
- **1章ずつ** 問題文・解答解説を分けて実行すると、照合がしやすく、誤字脱字も減らしやすい。
- 画像の **ページ番号**（page_0001 など）と、問題番号・解答ページの対応をメモしておくと、照合時に参照しやすい。
- 照合レポートは `scoring_result` や `docs` に「Chapter○_照合結果.md」のように保存しておくと、後から見直しやすい。

---

## 関連

- 採点結果の基準となる解答ファイル: `java_blackbook\local_problems\answers\Chapter○_answers.md`
- 採点結果の更新: 解答を修正したあとは、`java_blackbook\local_problems\scoring_result\Chapter○_ScoringResult_*.md` と演習ファイルの照合を行い、必要なら採点内容を修正する。
