# 画像→テキスト化・保存・照合チェック用 プロンプト

書籍・問題集の画像を**一言一句正確に漏らさず**テキストに起こし、**グラフ・図・図解もMarkdown形式で再現**して指定ファイルに保存するためのプロンプトです。

**2段階に分けて実行**します。  
- **第1段階（プロンプト1）**: 画像を **1枚ずつ** 読み取り、**書き起こしのみ** 行い、生テキストを保存する。  
- **第2段階（プロンプト2）**: 書き起こしファイルを **文言は変えず** 問題用・解答用の Markdown に **整形のみ** 行う。  

必要に応じて、元画像と照合して誤字脱字を減らす（簡易版プロンプト）。

---

## 前提・実行環境

- **画像は指定された画像フォルダ（絶対パス）に置く**。
- **テキスト化は生成AI が画像を直接読み取る**。Python 等のスクリプトやコマンドは使わない。画像は絶対パスで指定し、**1枚ずつ**開いて書き起こす。
- **第1段階**: AI は「1枚ずつ画像を読み取り、書き起こしのみ」を行い、指定ファイルに追記する。
- **第2段階**: AI は「書き起こしファイルを読み、文言を変えずに問題用・解答用の Markdown に整形」する。

---

## 使い方（2段階に分けて実行）

1. **第1段階**: 下記 **プロンプト1（書き起こしのみ）** をコピーし、「指定」を記入して AI に渡す。**1枚ずつ**画像を読み取り、書き起こしだけを行い、指定ファイルに追記する。全画像が終わるまで繰り返す。
2. **第2段階**: 第1段階で保存した「書き起こしファイル」の内容を用意する。下記 **プロンプト2（整形のみ）** をコピーし、「指定」を記入して AI に渡す。**文言は1文字も変えず**、問題用・解答用の Markdown に整形して保存する。
3. **照合**: 必要に応じて簡易版（照合のみ）のプロンプトで、元画像と照合する。

---

## プロンプト1：第1段階（書き起こしのみ・1枚ずつ）

**役割**: 画像を **1枚ずつ** 開き、そのページのテキストを **逐語で書き起こすだけ** 行う。整形・問題/解答の分類は行わない。

```
あなたは、技術書・問題集のページ画像に書かれたテキストを、**一言一句漏らさず逐語で書き起こす**専門家です。要約・言い換え・解説の付与は一切しません。**1回に1枚だけ**画像を読み取り、そのページのテキストだけを出力します。

## 指定（最初に記入すること）

以下を実行前に必ず記入する。

- **画像フォルダ（入力）**: [画像フォルダの絶対パス]
  - 例: `C:\Users\xxx\project\pdf_output\ch4_JavaSE17Silver_images`
  - 1ページ1画像で、ファイル名にページ番号（例: page_0001.png）が含まれる想定。
- **書き起こしの保存先**: [書き起こし用ファイルの相対パス]
  - 例: `java_blackbook\local_problems\raw_transcript\Chapter4_raw.md`
  - ここに「ページ識別子 + そのページの本文」を追記する。

## やること（書き起こしのみ）

- **1回のやり取りで1枚だけ**、上記画像フォルダ内の画像を1枚指定して開く。
- その画像に書かれているテキストを、**要約せず・言い換えず・省略せず**、逐語で書き起こす。
- **整形はしない**: 見出し（##）やコードブロック（```）は付けない。生のテキストとして書き起こす。改行・段落・句読点・括弧の種類は画像どおりに再現する。
- **図・表**: グラフ・図・図解は、画像に書かれた文言・数値・ラベルを漏らさずテキストで記述する（例: 【図の説明】として要素・関係・数値を箇条書き。表は行・列の内容をそのまま列挙）。
- 出力形式:
  1. その回で読んだ画像の **ファイル名**（例: `page_0001.png`）を1行で書く。
  2. 空行を1行入れる。
  3. そのページの **本文のみ** を書き起こす（見出し記号やコードブロックは使わない）。
  4. 最後に区切りとして `---` を1行入れる。
- 上記の内容を「書き起こしの保存先」に **追記** する。既存の内容は消さない。

## 禁止すること

- 複数枚を一度に読み取らない（必ず1枚ずつ）。
- 要約・解説・言い換えをしない。
- 問題用・解答用への分類をしない（第2段階で行う）。
- Markdown の見出し・コードブロック・箇条書き記法を付けない（生テキストのみ）。

## 進め方

- まず画像フォルダ内のファイル一覧を把握し、**先頭の画像から1枚目**を開いて書き起こし、保存先に追記する。
- 次のやり取りでは「2枚目の画像」を開き、同様に書き起こして追記する。**全画像について、1枚ずつ順番に**同じ手順を繰り返す。
- どの画像まで完了したかを毎回明示し、次に読む画像のファイル名を指定してから読み取る。
```

---

## プロンプト2：第2段階（整形のみ）

**役割**: 第1段階で保存した「書き起こしテキスト」を入力として、**文言は1文字も変えず**、問題用・解答用の Markdown に整形して保存する。

```
あなたは、書き起こし済みのテキストを、**文言を1文字も変えずに**問題用・解答用の Markdown に整形する専門家です。要約・言い換え・省略は禁止です。見出し・コードブロック・箇条書き・表・図の Markdown 再現だけを追加します。

## 指定（最初に記入すること）

以下を実行前に必ず記入する。

- **書き起こしファイル（入力）**: [第1段階で保存したファイルの相対パス]
  - 例: `java_blackbook\local_problems\raw_transcript\Chapter4_raw.md`
- **問題文の保存先**: [問題文用 Markdown の相対パス]
  - 例: `java_blackbook\local_problems\questions\Chapter4_questions.md`
- **解答解説の保存先**: [解答解説用 Markdown の相対パス]
  - 例: `java_blackbook\local_problems\answers\Chapter4_answers.md`

## やること（整形のみ）

- 上記「書き起こしファイル」の内容を読み、**問題が載っているページ**のテキストを問題用、「解答・解説」が載っているページのテキストを解答用に振り分ける。
- 各テキストの **文言は1文字も変えず**、次の形式に整形する。

**問題文用**
- 章見出し（例: 第○章 ○○）
- 各問を `## 1.` `## 2.` … のように見出しで区切る。
- コードは ```java … ``` で囲む（言語指定は可能なら付ける）。
- 選択肢は `- A. 〜` `- B. 〜` の形式で箇条書き。
- 空欄は `__________` や `// この部分が空欄` などで明示する。

**解答解説用**
- 各問を `## 1. C` のように「番号. 正解」で見出し。正解が複数なら `## 2. A, C, D` のように含める。
- 解説は段落・リスト・コードブロックで整形する。文言は変えない。

**グラフ・図・図解**
- 表形式の図: Markdown の表（`| 列1 | 列2 |`）で再現。セル結合が必要な場合は説明を補足。
- フローチャート・構成図: Mermaid（` ```mermaid … ``` `）の flowchart / sequenceDiagram / classDiagram などで再現。
- 棒グラフ・円グラフ: Mermaid の `pie`・`xychart-beta` または表で数値・ラベルを画像どおりに記載。
- 複雑な図: ASCII アートまたは【図の説明】で要素・関係・数値を漏らさず記述。

- 整形した結果を「問題文の保存先」「解答解説の保存先」に **保存** する。同じ問が複数ページにまたがる場合は1問としてつなげる。

## 禁止すること

- 書き起こしテキストの **文言の変更・要約・言い換え・省略** をしない。
- 図や表の **数値・ラベル** を変えない。
```

---

## テンプレート（置き換え用）

**プロンプト1（第1段階）** で使うプレースホルダ:

| プレースホルダ | 説明 | 例 |
|----------------|------|-----|
| `[画像フォルダの絶対パス]` | ページ画像が入ったフォルダ（**絶対パス**） | `C:\Users\xxx\project\pdf_output\ch4_JavaSE17Silver_images` |
| `[書き起こし用ファイルの相対パス]` | 書き起こし結果を追記するファイル（生テキスト） | `java_blackbook\local_problems\raw_transcript\Chapter4_raw.md` |

**プロンプト2（第2段階）** で使うプレースホルダ:

| プレースホルダ | 説明 | 例 |
|----------------|------|-----|
| `[第1段階で保存したファイルの相対パス]` | プロンプト1で保存した書き起こしファイル | `java_blackbook\local_problems\raw_transcript\Chapter4_raw.md` |
| `[問題文用ファイルの相対パス]` | 問題文を保存する Markdown | `java_blackbook\local_problems\questions\Chapter4_questions.md` |
| `[解答解説用ファイルの相対パス]` | 解答・解説を保存する Markdown | `java_blackbook\local_problems\answers\Chapter4_answers.md` |

---

## 簡易版（チェックのみ行う場合）

すでにテキスト化済みで、「照合チェックだけ」行いたいとき用の短いプロンプトです。画像は生成AI が直接開いて読み取り、照合する。照合時は**一言一句漏れ・省略がないか**も確認する。

```
次の2つのファイルの内容が、指定フォルダ内の画像と一致しているか照合してください。

- 問題文: [問題文ファイルの相対パス]
- 解答解説: [解答解説ファイルの相対パス]
- 照合元画像: [画像フォルダの絶対パス]（生成AI が画像を直接開いて読み取り、照合する）

手順:
1. 各問について、対応する画像を開き（生成AI が画像を直接読み取る）、問題文・コード・選択肢・正解・**グラフ・図・図解の再現**を比較する。
2. 一致している部分は「一致」として一覧またはまとめで報告する。
3. 誤字脱字・行番号の誤り・正解の誤りがあれば「要修正」として、問番号・該当箇所・正しい内容を記載する。
4. 要修正箇所は、該当するMarkdownファイルを編集して修正する。
```

---

## 運用のコツ

- **第1段階は必ず1枚ずつ**: 1回のやり取りで1枚だけ画像を開き、書き起こしを確定してから次に進む。複数枚まとめて読まない。
- テキスト化・照合時は **生成AI が画像を直接開いて読み取り（OCR）して** 行う（絶対パスで画像を指定する）。Python 等のスクリプトやコマンドは使わない。
- **第1段階では整形しない**: 書き起こしは生テキストのみ。見出し・コードブロックは第2段階で付ける。
- **第2段階では文言を変えない**: 書き起こしファイルの文言を1文字も変えず、見出し・コードブロック・箇条書きなどの形式だけを付ける。
- **グラフ・図・図解**は、第1段階では文言・数値を漏らさずテキストで記述し、第2段階で表・Mermaid などに整形する。
- **1章ずつ** 書き起こし→整形の流れで実行すると、照合がしやすく、誤字脱字も減らしやすい。
- 画像の **ページ番号**（page_0001 など）と、問題番号・解答ページの対応をメモしておくと、照合時に参照しやすい。
- 照合レポートは `scoring_result` や `docs` に「Chapter○_照合結果.md」のように保存しておくと、後から見直しやすい。

---

## 一字一句漏らさず出力させたい場合（プロンプト以外の対策）

「逐語的・要約禁止」と指定しても解説が要約されてしまう場合は、**プロンプトの修正以外**の運用で対応できることがあります。

- **詳細**: [VERBATIM_TRANSCRIPTION_OPTIONS.md](VERBATIM_TRANSCRIPTION_OPTIONS.md) を参照。
- **要点**:
  - **OCR ファースト**: 全ページを `LearningTools/image-to-text-batch` で OCR し、その生テキストを「正」とする。AI には「文言を1文字も変えず Markdown に整形する」だけを依頼する。
  - **1 ページずつ**: 読み取りは 1 枚ずつ行い、そのページ分のテキストを確定してから次に進む。
  - **二段階**: まず「転写のみ」で出力を確定し、別タスクで「整形のみ」を行う。

---

## 関連

- 採点結果の基準となる解答ファイル: `java_blackbook\local_problems\answers\Chapter○_answers.md`
- 採点結果の更新: 解答を修正したあとは、`java_blackbook\local_problems\scoring_result\Chapter○_ScoringResult_*.md` と演習ファイルの照合を行い、必要なら採点内容を修正する。
